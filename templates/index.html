<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../static/layui/css/layui.css"  media="all">
  <script src="../static/layui/layui.js" charset="utf-8"></script>
  <script src="../static/echarts.min.js"></script>

</head>
<style>
    .layui-form-item{
        width: 60%;

    }
    .layui-tab-item{
        padding-top:40px ;
    }
    .layui-tab-item>.model-predict{
        float: left;
        width: 50%;

    }
    .model-predict .layui-form-item{
        width: 100%;

    }
    .predict-result{
        float: right;
        width: 50%;
        height: 550px;
         margin-top: -20px;

    }
</style>
<body>
<div class="layui-tab layui-tab-card" style="width: 80%;margin: 60px auto">
  <ul class="layui-tab-title">
    <li class="layui-this">数据处理</li>
    <li>Lstm模型</li>
    <li>Svr模型</li>
    <li>模型预测</li>
    <li>生成word报文</li>
  </ul>
  <div class="layui-tab-content" style="height: 500px">
      <!-- 数据处理部分 -->
    <div class="layui-tab-item layui-show">
        <form class="layui-form" action="http://localhost:5000/process/ob/get_dir" method=post>
            <div class="layui-form-item">
                <label class="layui-form-label">ob:</label>
                <div class="layui-input-block">
                    <input type="text" name="ob_dir" lay-verify="required" autocomplete="off" placeholder="请输入ob文件路径" class="layui-input">

                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ec:</label>
                <div class="layui-input-block">
                    <input type="text" name="ec_dir" lay-verify="required" autocomplete="off" placeholder="请输入ec文件路径" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button button class="layui-btn" lay-submit lay-filter="formDemo">上传</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>

      <!-- lstm建模 -->
    <div class="layui-tab-item ">
        <form class="layui-form" action="http://localhost:5000/build_lstm_data" method=post>
            <div class="layui-form-item">
                <label class="layui-form-label">ID:</label>
                <div class="layui-input-block">
                    <input type="text" name="id" lay-verify="required" autocomplete="off" placeholder="请输入站点ID" class="layui-input">
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">起报时间</label>
                <div class="layui-input-block">
                    <select name="time" lay-filter="aihao">
                        <option value="08">08</option>
                        <option value="20">20</option>
                    </select>
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">类型</label>
                <div class="layui-input-block">
                    <select name="type" lay-filter="aihao">
                        <option value ="10UV">10UV</option>
  			            <option value ="10FG6">10FG6</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">原始文件夹路径:</label>
                <div class="layui-input-block">
                    <input type="text" name="dir" lay-verify="required" autocomplete="off" placeholder="请输入原始文件夹路径:" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button button class="layui-btn" lay-submit lay-filter="formDemo">上传</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

    </form>
    </div>
      <!-- svr建模 -->
    <div class="layui-tab-item ">
        <form class="layui-form" action="http://localhost:5000/build_svr_data" method=post>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">起报时间</label>
                <div class="layui-input-block">
                    <select name="time" lay-filter="aihao">
                        <option value="08">08</option>
                        <option value="20">20</option>
                    </select>
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">类型</label>
                <div class="layui-input-block">
                    <select name="type" lay-filter="aihao">
                        <option value ="10UV">10UV</option>
  			            <option value ="10FG6">10FG6</option>
                    </select>
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">预报第几天</label>
                <div class="layui-input-block">
                    <select name='predict_day' lay-filter="aihao">
                        <option value =1>1</option>
			            <option value =2>2</option>
			            <option value =3>3</option>
			            <option value =4>4</option>
			            <option value =5>5</option>
			            <option value =6>6</option>
			            <option value =7>7</option>
                        <option value =8>8</option>
			            <option value =9>9</option>
			            <option value =10>10</option>
                    </select>
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">季节</label>
                <div class="layui-input-block">
                    <select name='season' lay-filter="aihao">
                        <option value ="3-4">3-4</option>
  			            <option value ="5-6">5-6</option>
  			            <option value ="7-9">7-9</option>
  			            <option value ="10-11">10-11</option>
  			            <option value ="12-2">12-2</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ob原始文件路径:</label>
                <div class="layui-input-block">
                    <input type="text" name="ob_dir" lay-verify="required" autocomplete="off" placeholder="请输入ob原始文件路径" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ec原始文件路径:</label>
                <div class="layui-input-block">
                    <input type="text" name="ec_dir" lay-verify="required" autocomplete="off" placeholder="请输入ec原始文件路径" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button button class="layui-btn" lay-submit lay-filter="formDemo">上传</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
      <!-- 模型预测 -->
    <div class="layui-tab-item ">
        <form class="layui-form model-predict" action="http://localhost:5000/predict" method=post>
            <div class="layui-form-item">
                <label class="layui-form-label">ID:</label>
                <div class="layui-input-block">
                    <input type="text" name="id" lay-verify="required" autocomplete="off" placeholder="请输入站点ID" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">预测日期：</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="test1" placeholder="yyyy-MM-dd" name="predict_date">
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">起报时间</label>
                <div class="layui-input-block">
                    <select name="time" lay-filter="aihao">
                        <option value="08">08</option>
                        <option value="20">20</option>
                    </select>
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">预测第几天</label>
                <div class="layui-input-block">
                    <select name='predict_day' lay-filter="aihao">
                        <option value =1>1</option>
                        <option value =2>2</option>
                        <option value =3>3</option>
                        <option value =4>4</option>
                        <option value =5>5</option>
                        <option value =6>6</option>
                        <option value =7>7</option>
                        <option value =8>8</option>
                        <option value =9>9</option>
                        <option value =10>10</option>
                    </select>
                </div>
            </div>
            <div class="layui-form layui-form-item">
                <label class="layui-form-label">类型</label>
                <div class="layui-input-block">
                    <select name="type" lay-filter="aihao">
                        <option value ="10UV">10UV</option>
                        <option value ="10FG6">10FG6</option>
                </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ob原始文件路径:</label>
                <div class="layui-input-block">
                    <input type="text" name="ob_dir" lay-verify="required" autocomplete="off" placeholder="请输入ob原始文件路径" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ec原始文件路径:</label>
                <div class="layui-input-block">
                    <input type="text" name="ec_dir" lay-verify="required" autocomplete="off" placeholder="请输入ec原始文件路径" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button button class="layui-btn" lay-submit lay-filter="formDemo">上传</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

        </form>
        <div class="predict-result">
            <div id="main" style="width: 500px;height:480px;padding-left: 50px;"></div>
        </div>
    </div>
    <div class="layui-tab-item">
        <button type="button" class="layui-btn ">点击生成word报文</button>
    </div>
</div>
</body>

<script>
    let data = {
    rain: [8, 18, 8, 12, 0, 19, 21, 19, 24.8, 23, 29.7],
    tmp: [12, 13, 9.7, 8, -6, 15, 25, 15, 23, 14, 23],
    winds: [3, 2.8, 5, 6.8, 6.4, 8, 7, 8.4, 7, 8, 10],
    pre: [600, 400, 550, 580, 400, 500, 700, 500, 600, 700, 650]
}

let colors = ['#4BC946', '#FDA975', '#27D3E2', '#FF0014'];
let splitNumber = 5; // 分割段数

//计算最大值
function calMax(arr) {
    let min = Math.min.apply(null, arr);
    let max = Math.max.apply(null, arr);
    let interval = (max - min) / splitNumber; // 平均值
    max = Math.ceil(max + interval); // 向上取整
    // console.log(min, max, interval);
    return max;
}

//计算最小值
function calMin(arr) {
    let min = Math.min.apply(null, arr);
    let max = Math.max.apply(null, arr);
    let interval = (max - min) / splitNumber; // 平均值
    min = min === 0 ? min : Math.floor(min - interval); // 向下取整
    // console.log(min, max, interval);
    return min;

}
    // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        // 指定图表的配置项和数据
        var option = {
    color: colors,
    backgroundColor: '#fff',
    title: {
        text: '2020年12月1日F2273站点预测',
        subtext: '预测时间：2020/12/1 08:00-2020/12/10 08:00',
        top: '1%',
        x: 'center',
        textStyle: { color: '#2D527C', fontSize: '20', fontWeight: 'bold'},
        subtextStyle: { color: '#2D527C', fontSize: '14', fontWeight: 'bold' }
    },
    grid: {
        top: '15%',
        bottom: '10%',
        left: '15%',
        right: '15%',
    },
    legend: {
        top: '0%',
        right:'0%'
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'shadow' }
    },
    xAxis: {
        type: 'category',
        axisTick: { show: false },
        axisLabel: {
            textStyle: { color: '#333333', fontSize: 14 }
        },
        axisLine: {
            show: false,
            lineStyle: { color: '#707070' }
        },
        data: ['12/1', '12/2', '12/3', '12/4', '12/5', '12/6', '12/7', '12/8', '12/9', '12/10']
    },
    yAxis: [{
        // name: '降水(mm)',
        type: 'value',
        position: 'left',
        min: calMin(data.rain),
        max: calMax(data.rain),
        splitNumber: splitNumber,
        interval: (calMax(data.rain) - calMin(data.rain)) / splitNumber,
        splitLine: {
            lineStyle: { type: 'dashed', color: '#707070' }
        },
        axisLabel: {
            // formatter: '{value}mm',
            formatter: function(value, index) {
                return (value + '').indexOf('.') != -1 ? value.toFixed(1) + 'mm' : value + 'mm';
            },
            textStyle: { color: colors[0], fontSize: 14 }
        },
        axisLine: { show: false },
        axisTick: { show: false }
    }, {
        // name: '气温(°C)',
        type: 'value',
        position: 'left',
        offset: 65,
        min: calMin(data.tmp),
        max: calMax(data.tmp),
        splitNumber: splitNumber,
        interval: (calMax(data.tmp) - calMin(data.tmp)) / splitNumber,
        splitLine: { show: false },
        axisLine: { show: false },
        axisLabel: {
            // formatter: '{value}°C',
            formatter: function(value, index) {
                return parseInt(value) + '°C';
            },
            textStyle: { color: colors[1], fontSize: 14 }
        },
        axisTick: { show: false }
    }, {
        // name: '风速(m/s)',
        type: 'value',
        position: 'right',
        min: calMin(data.winds),
        max: calMax(data.winds),
        splitNumber: splitNumber,
        interval: (calMax(data.winds) - calMin(data.winds)) / splitNumber,
        splitLine: { show: false },
        axisLine: { show: false },
        axisLabel: {
            // formatter: '{value}m/s',
            formatter: function(value, index) {
                return parseInt(value) + 'm/s';
            },
            textStyle: { color: colors[3], fontSize: 14 }
        },
        axisTick: { show: false }
    }],
    series: [
        {
            name: '风速',
            type: 'line',
            symbol: 'circle',
            symbolSize: 8,
            yAxisIndex: 2,
            data: data.winds
        }
    ]
};
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);layui.use('upload', function() {
        layui.use(['form', 'layedit', 'element','laydate'], function () {
            var form = layui.form
            var $ = layui.jquery
                , layer = layui.layer
                , layedit = layui.layedit
                , laydate = layui.laydate
                , element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
            //触发事件
            var active = {
                tabAdd: function () {
                    //新增一个Tab项
                    element.tabAdd('demo', {
                        title: '新选项' + (Math.random() * 1000 | 0) //用于演示
                        , content: '内容' + (Math.random() * 1000 | 0)
                        , id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                    })
                }
                , tabDelete: function (othis) {
                    //删除指定Tab项
                    element.tabDelete('demo', '44'); //删除：“商品管理”


                    othis.addClass('layui-btn-disabled');
                }
                , tabChange: function () {
                    //切换到指定Tab项
                    element.tabChange('demo', '22'); //切换到：用户管理
                }
            };

            //常规用法 时间控件
            laydate.render({
                elem: '#test1'
            });
            $('.site-demo-active').on('click', function () {
                var othis = $(this), type = othis.data('type');
                active[type] ? active[type].call(this, othis) : '';
            });

            //Hash地址的定位
            var layid = location.hash.replace(/^#test=/, '');
            element.tabChange('test', layid);

            element.on('tab(test)', function (elem) {
                location.hash = 'test=' + $(this).attr('lay-id');
            });

            //日期
            laydate.render({
                elem: '#date'
            });
            laydate.render({
                elem: '#date1'
            });

            //创建一个编辑器
            var editIndex = layedit.build('LAY_demo_editor');

            //自定义验证规则
            form.verify({
                title: function (value) {
                    if (value.length < 5) {
                        return '标题至少得5个字符啊';
                    }
                }
                , pass: [
                    /^[\S]{6,12}$/
                    , '密码必须6到12位，且不能出现空格'
                ]
                , content: function (value) {
                    layedit.sync(editIndex);
                }
            });

            //监听指定开关
            form.on('switch(switchTest)', function (data) {
                layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                    offset: '6px'
                });
                layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
            });

            //监听提交
            form.on('submit(demo1)', function (data) {
                layer.alert(JSON.stringify(data.field), {
                    title: '最终的提交信息'
                })
                return false;
            });

            //表单赋值
            layui.$('#LAY-component-form-setval').on('click', function () {
                form.val('example', {
                    "username": "贤心" // "name": "value"
                    , "password": "123456"
                    , "interest": 1
                    , "like[write]": true //复选框选中状态
                    , "close": true //开关状态
                    , "sex": "女"
                    , "desc": "我爱 layui"
                });
            });

            //表单取值
            layui.$('#LAY-component-form-getval').on('click', function () {
                var data = form.val('example');
                alert(JSON.stringify(data));
            });
        })
    })

</script>
</html>